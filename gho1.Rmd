---
title: "Analiza częstości występowania cukrzycy w Europie"
author: "TP"
date: "2026"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE)

## dołączenie niezbędnych bibliotek
library("tidyverse")
library("knitr")
library('scales')
```

# Żródło danych

Dane na temat dzietności pobrano z bazy WHO; wskaźnik
NCD_DIABETES_PREVALENCE_AGESTD

```{r}
library('rgho')
library('tidyverse')

##
## Prevalence of diabets (Częstość występowania cukrzycy)
## Dane wg wszystkich wymiarów
prev.diabets <- get_gho_data( code='NCD_DIABETES_PREVALENCE_AGESTD') 
##
## Dane są ściągane jako napisy
## Dlatego warto je zamienić na odpowiednie typy, np rok na liczbę
## wyrażenie |> funkcja -- operator potoku, przekaż wynik wyrażenia jako argument funkcji
##
prev.diabets.0 <- prev.diabets |>
  select (p=NumericValue, COUNTRY, year=YEAR, sex=SEX, AGEGROUP, ParentLocationCode) |>
  mutate (p = as.numeric(p), 
          year = as.numeric(year))

## Analiza krajów Europejskich
## dla grupy wiekowej 30+
## ---------------------------
## Tylko kraje europejskie
## Tylko lata 2000, 2010 oraz 2022
## Tylko łącznie (Płeć)
## Tylko grupa wiekowa 30+
prev.diabets.eur <- prev.diabets.0 |> 
  filter (ParentLocationCode == 'EUR') |> ## Europa
  filter (year == 2000 | year == 2010 | year == 2022) |> ## rok
  filter (sex == 'BTSX') |> ## płeć
  filter (AGEGROUP == 'YEARS30-PLUS') ## grupa wiekowa
```

## Analiza parametryczna

Analizowano kraje Europejskie (w sensie definicji WHO :-)).
W tabeli zamieszczono średnie wartości odsetka osób (w wieku 30 lat i więcej) 
z cukrzycą.

```{r}
## wartości sumaryczne
## grupujemy wg lat
## obliczamy średnią, medianę oraz odchylenie standardowe
prev.diabets.eur.summ <- prev.diabets.eur |>
  group_by(year) |>
  summarise(średnia = mean(p, na.rm = TRUE),
            mediana = median (p),
            sd = sd (p, na.rm = TRUE)
            )

knitr::kable(prev.diabets.eur.summ)
```

Wartości średnie (zarówno średnia jak i mediana) rosną w badanych latach.
Podobnie rośnie zróżnicowanie mierzone za pomocą odchylenia standardowego (sd)

Zależności powyższe pokazano także na wykresie pudełkowym oraz
punktowym

```{r}
prev.diabets.pl <- prev.diabets.eur |> filter (COUNTRY == 'POL')
## wykres podełkowy
pic1 <- prev.diabets.eur |> 
  ggplot(aes(y=p, x=as.factor(year) )) +
  geom_boxplot() +
  ylab("#") +
  ggtitle("??") +
  xlab('') +
  ## opcjonalnie
  ## położenie Polski
  geom_point(
    data = prev.diabets.pl,
    aes(x = as.factor(year), y = p ),
    color = "red",
    size = 3
  )
pic1

## wykres punktowy
pic2 <- prev.diabets.eur |> 
  ggplot(aes(y=p, x=as.factor(year) )) +
  geom_jitter(width = 0.1, alpha=.5) +
  ylab("#") +
  ggtitle("??") +
  xlab('') +
  ## Polska
  geom_point(
    data = prev.diabets.pl,
    aes(x = as.factor(year), y = p ),
    color = "red",
    size = 2
  )
pic2
```

## Średnie tempo wzrostu

Średnie tempo wzrostu przedstawiono w tabeli:

```{r}
## Porównanie w czasie
## chatGPT
prev.diabets.eur.all <- prev.diabets.0 |> 
  filter (ParentLocationCode == 'EUR') |>
  filter (sex == 'BTSX') |>
  filter (AGEGROUP == 'YEARS30-PLUS') |>
  ## dla pewności
  arrange(COUNTRY, year)

## Średnie tempo wzrostu wg wzoru:
## stw = (p_t/p_1)^{1/(t-1) -1}, gdzie
## p_t ostatnia obserwacja
## p_1 pierwsza obserwacja
## ^ oznacza potęgowanie, wykładnikiem potęgi jest 1/(t-1)
##
prev.diabets.eur.all.sum <-  prev.diabets.eur.all |>
 group_by(COUNTRY) |>
   summarise(
     ## średnie temp w %
     srednie_tempo = ((last(p) / first(p))^(1 / (n() - 1)) - 1 ) * 100,
   ) |>
  ungroup()
knitr::kable(prev.diabets.eur.all.sum)
```


## Dynamika dla wybranych krajów
 
Na rysunku przedstawiono częstość występowania cukrzycy w Polsce (POL),
Włoszech (ITA) oraz w Niemczech (DEU)

```{r}
## Porownanie w czasie dla wybranych krajów
prev.diabets.eur.pid <- prev.diabets.eur.all |>
  filter (COUNTRY == 'POL' | COUNTRY == 'ITA' | COUNTRY == 'DEU')

pic3 <- prev.diabets.eur.pid |> 
  ggplot(aes(y=p, x=year, color=COUNTRY )) +
  geom_line() +
  ylab("#") +
  ggtitle("??") +
  xlab('')
pic3
```

## Wnioski